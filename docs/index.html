<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zodiac Mapper | Cosmic Explorer</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
</head>
<body>
    <div class="cosmic-bg">
        <div class="stars"></div>
        <div class="nebula"></div>
    </div>

    <div class="app-container">
        <header>
            <div class="brand">
                <span class="logo-icon">‚ú®</span>
                <h1>Zodiac Mapper</h1>
            </div>
            <p class="tagline">Universal Zodiac Converter & Calculator</p>
            <div class="header-actions">
                <a href="https://github.com/fixicelo/zodiac-mapper" class="github-btn" target="_blank" rel="noopener">
                    <svg height="20" width="20" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
                    </svg>
                    <span>GitHub</span>
                </a>
            </div>
        </header>

        <main>
            <div class="glass-panel main-explorer">
                <div class="explorer-inputs">
                    <div class="tabs">
                        <button class="tab-btn active" data-tab="name">üîç By Name</button>
                        <button class="tab-btn" data-tab="date">üìÖ By Date</button>
                    </div>

                    <div class="tab-content active" id="tab-name">
                        <div class="input-wrapper">
                            <label>Type any zodiac name (e.g. "Aries", "ÁôΩÁæä", "‚ôà")</label>
                            <div class="relative-input-container">
                                <input type="text" id="text-input" class="cosmic-input" placeholder="Enter sign name...">
                                <button class="clear-btn" id="clear-text" aria-label="Clear input">‚úï</button>
                            </div>
                        </div>
                    </div>

                    <div class="tab-content" id="tab-date">
                        <div class="input-wrapper">
                            <label>Enter date (MM-DD) or pick from calendar</label>
                            <div class="date-input-group">
                                <div class="relative-input-container">
                                    <input type="text" id="date-text-input" class="cosmic-input" placeholder="e.g. 03-21" maxlength="10">
                                    <button class="clear-btn" id="clear-date" aria-label="Clear input">‚úï</button>
                                </div>
                                <button id="calendar-trigger" class="calendar-btn" title="Open Calendar">üìÖ</button>
                                <input type="date" id="date-picker" class="hidden-picker" title="Date Picker">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="explorer-output">
                    <div id="result-display" class="result-display hidden">
                        <div class="result-glow"></div>
                        <div class="result-content">
                            <div class="result-icon"></div>
                            <h2 class="result-name"></h2>
                            <div class="result-date"></div>
                            <br/>
                            <div class="result-meta"></div>
                        </div>
                    </div>
                    
                    <div id="empty-state" class="empty-state">
                        <div class="constellation-bg"></div>
                        <p>Select a date or enter a name to reveal the stars.</p>
                    </div>
                </div>
            </div>

            <section class="reference-section">
                <h3>Zodiac Reference Table</h3>
                <div class="table-container">
                    <table class="zodiac-table" id="zodiac-table">
                        <thead>
                            <tr>
                                <th>Sign</th>
                                <th>Date Range</th>
                                <th>English</th>
                                <th>‰∏≠Êñá</th>
                                <th>‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</th>
                                <th>Espa√±ol</th>
                                <th>ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</th>
                                <th>Fran√ßais</th>
                                <th>Portugu√™s</th>
                                <th>–†—É—Å—Å–∫–∏–π</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </section>
        </main>

        <footer>
            <p>Built with <a href="https://github.com/fixicelo/zodiac-mapper">zodiac-mapper</a></p>
        </footer>
    </div>

    <script type="module">
        // Dynamic Import with Fallback Strategy
        async function loadZodiacModule() {
            const sources = [
                'https://cdn.jsdelivr.net/npm/zodiac-mapper@latest/dist/index.min.mjs',
                'https://esm.sh/zodiac-mapper'
            ];

            for (const src of sources) {
                try {
                    const module = await import(src);
                    console.log(`Loaded zodiac-mapper from: ${src}`);
                    return module;
                } catch (err) {
                    console.warn(`Failed to load from ${src}:`, err);
                }
            }
            throw new Error('Failed to load zodiac-mapper from all CDNs. Please check your internet connection.');
        }

        let zodiacModule;
        try {
            zodiacModule = await loadZodiacModule();
        } catch (error) {
            document.querySelector('.app-container').innerHTML = `
                <div style="text-align: center; padding: 4rem 2rem;">
                    <h2 style="color: #ff6b6b; margin-bottom: 1rem; font-size: 2rem;">‚ö†Ô∏è Error</h2>
                    <p style="font-size: 1.2rem; margin-bottom: 2rem;">${error.message}</p>
                    <button onclick="location.reload()" class="tab-btn active" style="padding: 0.8rem 2rem;">Retry Connection</button>
                </div>
            `;
            throw error;
        }

        const { findFirstZodiacInText, getZodiacDateRange, getZodiacNames, getZodiacSignFromDate, ZodiacSign } = zodiacModule;

        function formatDateRange(range) {
            const pad = (n) => n.toString().padStart(2, '0');
            const start = `${pad(range.start.month)}-${pad(range.start.day)}`;
            const end = `${pad(range.end.month)}-${pad(range.end.day)}`;
            return `${start} ~ ${end}`;
        }

        // Tab Switching
        const tabs = document.querySelectorAll('.tab-btn');
        const contents = document.querySelectorAll('.tab-content');
        
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                tabs.forEach(t => { t.classList.remove('active'); });
                contents.forEach(c => { c.classList.remove('active'); });
                tab.classList.add('active');
                document.getElementById(`tab-${tab.dataset.tab}`).classList.add('active');
                
                // Clear inputs when switching
                document.getElementById('date-text-input').value = '';
                document.getElementById('date-picker').value = '';
                document.getElementById('text-input').value = '';
                hideResult();
            });
        });

        // Result Display Logic
        const resultDisplay = document.getElementById('result-display');
        const emptyState = document.getElementById('empty-state');

        function showResult(sign, metaText = '') {
            const emoji = getZodiacNames(sign, 'symbols')[0] || '';
            const name = getZodiacNames(sign, 'en')[0] || sign;
            const range = getZodiacDateRange(sign);
            
            resultDisplay.querySelector('.result-icon').textContent = emoji;
            resultDisplay.querySelector('.result-name').textContent = name;
            resultDisplay.querySelector('.result-date').textContent = formatDateRange(range);
            
            const metaEl = resultDisplay.querySelector('.result-meta');
            if (metaText) {
                metaEl.textContent = metaText;
            } else {
                metaEl.style.display = 'none';
            }
            
            resultDisplay.removeAttribute('data-element');

            // Highlight Table Row
            document.querySelectorAll('.highlight-row').forEach(el => { el.classList.remove('highlight-row'); });
            const row = document.getElementById(`row-${sign}`);
            if (row) {
                row.classList.add('highlight-row');
                // row.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }

            resultDisplay.classList.remove('hidden');
            emptyState.classList.add('hidden');
        }

        function hideResult() {
            document.querySelectorAll('.highlight-row').forEach(el => { el.classList.remove('highlight-row'); });
            resultDisplay.classList.add('hidden');
            emptyState.classList.remove('hidden');
        }

        // Date Input Logic (Text + Picker)
        const dateTextInput = document.getElementById('date-text-input');
        const datePicker = document.getElementById('date-picker');
        const calendarBtn = document.getElementById('calendar-trigger');

        // 1. Handle Text Input
        dateTextInput.addEventListener('input', (e) => {
            const val = e.target.value.trim();
            // Allow clearing
            if (!val) return hideResult();
            
            // Try to parse if it looks like MM-DD or YYYY-MM-DD
            // Simple regex check to avoid throwing too many errors on partial input
            if (/^\d{1,2}-\d{1,2}$/.test(val) || /^\d{4}-\d{1,2}-\d{1,2}$/.test(val)) {
                try {
                    const sign = getZodiacSignFromDate(val);
                    showResult(sign);
                } catch (_err) {
                    // Ignore incomplete/invalid dates while typing
                }
            }
        });

        // 2. Handle Calendar Button
        calendarBtn.addEventListener('click', () => {
            // Show picker
            try {
                datePicker.showPicker(); 
            } catch (_e) {
                // Fallback for browsers not supporting showPicker (e.g. older Safari)
                datePicker.click();
            }
        });

        // 3. Handle Picker Change
        datePicker.addEventListener('change', (e) => {
            const val = e.target.value; // YYYY-MM-DD
            if (val) {
                // Extract MM-DD to show in text input (cleaner)
                const [_y, m, d] = val.split('-');
                const cleanDate = `${m}-${d}`;
                dateTextInput.value = cleanDate;
                
                // Trigger search
                try {
                    const sign = getZodiacSignFromDate(cleanDate);
                    showResult(sign);
                } catch (err) {
                    console.error(err);
                }
            }
        });

        // Text Input
        document.getElementById('text-input').addEventListener('input', (e) => {
            const val = e.target.value;
            if (!val.trim()) return hideResult();
            
            const match = findFirstZodiacInText(val);
            if (match) {
                showResult(match.sign, `Matched: "${match.match}"`);
            } else {
                hideResult();
            }
        });

        // Table Population
        const tableBody = document.querySelector('#zodiac-table tbody');
        Object.values(ZodiacSign).forEach(sign => {
            const emoji = getZodiacNames(sign, 'symbols')[0] || '';
            const name = getZodiacNames(sign, 'en')[0] || sign;
            const range = getZodiacDateRange(sign);
            
            const row = document.createElement('tr');
            row.id = `row-${sign}`;
            row.innerHTML = `
                <td class="col-sign"><span class="table-icon">${emoji}</span></td>
                <td class="col-date">${formatDateRange(range)}</td>
                <td class="col-lang">${name}</td>
                <td class="col-lang">${getZodiacNames(sign, 'zh')[0] || '-'}</td>
                <td class="col-lang">${getZodiacNames(sign, 'hi')[0] || '-'}</td>
                <td class="col-lang">${getZodiacNames(sign, 'es')[0] || '-'}</td>
                <td class="col-lang">${getZodiacNames(sign, 'ar')[0] || '-'}</td>
                <td class="col-lang">${getZodiacNames(sign, 'fr')[0] || '-'}</td>
                <td class="col-lang">${getZodiacNames(sign, 'pt')[0] || '-'}</td>
                <td class="col-lang">${getZodiacNames(sign, 'ru')[0] || '-'}</td>
            `;
            
            tableBody.appendChild(row);
        });

        // Clear Buttons Logic
        document.getElementById('clear-text').addEventListener('click', () => {
            document.getElementById('text-input').value = '';
            hideResult();
            document.getElementById('text-input').focus();
        });

        document.getElementById('clear-date').addEventListener('click', () => {
            document.getElementById('date-text-input').value = '';
            document.getElementById('date-picker').value = '';
            hideResult();
            document.getElementById('date-text-input').focus();
        });
    </script>
</body>
</html>
